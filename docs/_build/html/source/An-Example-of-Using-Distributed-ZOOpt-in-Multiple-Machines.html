

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>An-Example-of-Using-Distributed-ZOOpt-in-Multiple-Machines &mdash; zoopt  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> zoopt
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">An-Example-of-Using-Distributed-ZOOpt-in-Multiple-Machines</a><ul>
<li><a class="reference internal" href="#launch-servers">Launch Servers</a><ul>
<li><a class="reference internal" href="#launch-a-control-server">Launch a control server</a></li>
<li><a class="reference internal" href="#launch-evaluation-servers">Launch evaluation servers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#perform-optimization">Perform Optimization</a><ul>
<li><a class="reference internal" href="#define-the-objective-function-in-python">Define the objective function in Python</a></li>
<li><a class="reference internal" href="#write-client-code-in-julia">Write client code in Julia</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">zoopt</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>An-Example-of-Using-Distributed-ZOOpt-in-Multiple-Machines</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/An-Example-of-Using-Distributed-ZOOpt-in-Multiple-Machines.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="an-example-of-using-distributed-zoopt-in-multiple-machines">
<h1>An-Example-of-Using-Distributed-ZOOpt-in-Multiple-Machines<a class="headerlink" href="#an-example-of-using-distributed-zoopt-in-multiple-machines" title="Permalink to this headline">¶</a></h1>
<p>In this example, we have four machines: one for the client (M1), one for
control server (M2) and two for evaluation servers (M3 and M4).</p>
<div class="section" id="launch-servers">
<h2>Launch Servers<a class="headerlink" href="#launch-servers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="launch-a-control-server">
<h3>Launch a control server<a class="headerlink" href="#launch-a-control-server" title="Permalink to this headline">¶</a></h3>
<p>Write a simple start_control_server.py and upload it to M2. <a class="reference external" href="https://github.com/eyounx/ZOOsrv/blob/master/example/start_control_server.py">(Example
code in
ZOOsrv)</a></p>
<blockquote>
<div>start_control_server.py:</div></blockquote>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zoosrv</span> <span class="k">import</span> <span class="n">control_server</span>
<span class="n">control_server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span>
</pre></div>
</div>
<p>where the parameter 20000 is the listening port of the control server.
Then, run the codes as in command line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python start_control_server.py
</pre></div>
</div>
</div>
<div class="section" id="launch-evaluation-servers">
<h3>Launch evaluation servers<a class="headerlink" href="#launch-evaluation-servers" title="Permalink to this headline">¶</a></h3>
<p>Write a start_evaluation_server.py, including the following codes
<a class="reference external" href="https://github.com/eyounx/ZOOsrv/blob/master/example/start_evaluation_server.py">(Example code in
ZOOsrv)</a></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zoosrv</span> <span class="k">import</span> <span class="n">evaluation_server</span>
<span class="n">evaluation_server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s2">&quot;evaluation_server.cfg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where evaluation_server.cfg is the configuration file.</p>
<p>Then, write the evaluation_server.cfg file including the following
lines: <a class="reference external" href="https://github.com/eyounx/ZOOsrv/blob/master/example/evaluation_server.cfg">(Example code in
ZOOsrv)</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">evaluation</span> <span class="n">server</span><span class="p">]</span>
<span class="n">shared</span> <span class="n">fold</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">ZOOsrv</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">objective_function</span><span class="o">/</span>
<span class="n">control</span> <span class="n">server</span> <span class="n">ip_port</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.103</span><span class="p">:</span><span class="mi">20000</span>
<span class="n">evaluation</span> <span class="n">processes</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">starting</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">60003</span>
<span class="n">ending</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">60020</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">shared</span> <span class="pre">fold</span></code> is the fold storing the objective function files.
<code class="docutils literal notranslate"><span class="pre">control</span> <span class="pre">server</span> <span class="pre">ip_port</span></code> is the address of the control server, and the
last three lines state we want to start 10 evaluation processes by
choosing 10 available ports from 60003 to 60020. Notice that users can
write different configuration files for different machines.</p>
<p>Then, upload start_evaluation_server.py, evaluation_server.cfg and
the directory including objective function file (defined in the next
part) to M3 and M4.</p>
<p>Finally, launch evaluation servers respectively in M3 and M4.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python start_evaluation_server.py
</pre></div>
</div>
</div>
</div>
<div class="section" id="perform-optimization">
<h2>Perform Optimization<a class="headerlink" href="#perform-optimization" title="Permalink to this headline">¶</a></h2>
<p>We try to optimize the Ackley function.</p>
<div class="section" id="define-the-objective-function-in-python">
<h3>Define the objective function in Python<a class="headerlink" href="#define-the-objective-function-in-python" title="Permalink to this headline">¶</a></h3>
<p>Write <code class="docutils literal notranslate"><span class="pre">fx.py</span></code> including the following codes <a class="reference external" href="https://github.com/eyounx/ZOOsrv/blob/master/example/objective_function/fx.py">(Example code in
ZOOsrv)</a></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">ackley</span><span class="p">(</span><span class="n">solution</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([(</span><span class="n">i</span> <span class="o">-</span> <span class="n">bias</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">bias</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="o">-</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">bias</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="mf">20.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span>
    <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">shared</span> <span class="pre">fold</span></code> is the directory the <code class="docutils literal notranslate"><span class="pre">fx.py</span></code> stores.</p>
</div>
<div class="section" id="write-client-code-in-julia">
<h3>Write client code in Julia<a class="headerlink" href="#write-client-code-in-julia" title="Permalink to this headline">¶</a></h3>
<p>Write <code class="docutils literal notranslate"><span class="pre">client.jl</span></code> including the following codes <a class="reference external" href="https://github.com/eyounx/ZOOjl.jl/blob/master/example/client.jl">(Example code in
ZOOsrv)</a></p>
<div class="code julia highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">ZOOclient</span>
<span class="n">using</span> <span class="n">PyPlot</span>

<span class="c1"># define a Dimension object</span>
<span class="n">dim_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dim_regs</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">dim_size</span><span class="p">]</span>
<span class="n">dim_tys</span> <span class="o">=</span> <span class="p">[</span><span class="n">true</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">dim_size</span><span class="p">]</span>
<span class="n">mydim</span> <span class="o">=</span> <span class="n">Dimension</span><span class="p">(</span><span class="n">dim_size</span><span class="p">,</span> <span class="n">dim_regs</span><span class="p">,</span> <span class="n">dim_tys</span><span class="p">)</span>
<span class="c1"># define an Objective object</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span>

<span class="c1"># define a Parameter Object, the five parameters are indispensable.</span>
<span class="c1"># budget:  number of calls to the objective function</span>
<span class="c1"># evalueation_server_num: number of evaluation cores user requires</span>
<span class="c1"># control_server_ip_port: the ip:port of the control server</span>
<span class="c1"># objective_file: objective funtion is defined in this file</span>
<span class="c1"># func: name of the objective function</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">budget</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">evaluation_server_num</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">control_server_ip_port</span><span class="o">=</span><span class="s2">&quot;192.168.0.103:20000&quot;</span><span class="p">,</span>
    <span class="n">objective_file</span><span class="o">=</span><span class="s2">&quot;fx.py&quot;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="s2">&quot;ackley&quot;</span><span class="p">)</span>

<span class="c1"># perform optimization</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">zoo_min</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
<span class="c1"># print the Solution object</span>
<span class="n">sol_print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

<span class="c1"># visualize the optimization progress</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">get_history_bestsofar</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">plt</span><span class="p">[:</span><span class="n">plot</span><span class="p">](</span><span class="n">history</span><span class="p">)</span>
<span class="n">plt</span><span class="p">[:</span><span class="n">savefig</span><span class="p">](</span><span class="s2">&quot;figure.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Upload this file to the client machine (M1) and run it to perform the
optimization</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./julia -p 4 /absolute/path/to/your/file/client.jl
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">julia</span> <span class="pre">-p</span> <span class="pre">n</span></code> provides <code class="docutils literal notranslate"><span class="pre">n</span></code> processes for the client on the
local machine. Generally it makes sense for <code class="docutils literal notranslate"><span class="pre">n</span></code> to equal the number of
CPU cores on the machine.</p>
<p>For a few seconds, the optimization is done and we will get the result.</p>
<blockquote>
<div></div></blockquote>
<p>Visualized optimization progress looks like:</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, huhz.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>